<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Available Pets - PetPair</title>
  <link rel="stylesheet" href="pets.css" />
  <link rel="stylesheet" href="navbar.css" />
  <link rel="stylesheet" href="footer.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      color: #4B2E2E;
      background: #fff;
    }
    main {
      flex-grow: 1;
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
      width: 90%;
    }
    .pets-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
    }
    .pet-card {
      border: 1px solid #d8c7b3;
      border-radius: 8px;
      padding: 1rem;
      background: #f9f4ef;
      box-shadow: 2px 2px 8px rgb(121 82 49 / 0.2);
    }
    .pet-card img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 0.75rem;
    }
    .pet-card h3 {
      margin-top: 0;
      color: #7b5231;
    }
    .pet-attr {
      margin: 0.3rem 0;
      font-size: 0.95rem;
    }
    .maintenance {
      font-weight: 600;
      color: #a05b21;
      margin-top: 0.5rem;
    }

  
    .request-btn {
      margin-top: 10px;
      background-color: #7b5231;
      color: #f5f0e6;
      border: 1px solid #4b2e2e;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .request-btn:hover {
      background-color: #643f25;
    }
.remove-btn {
  margin-top: 10px;
  background-color: #7b5231; 
  color: #f5f0e6; 
  border: none;
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.remove-btn:hover {
  background-color: #5c3f23; 
}

  </style>
</head>
<body>

  <nav class="navbar">
    <div class="navbar-brand">PetPair</div>
    <input type="checkbox" id="toggle" class="navbar-toggle" />
    <label for="toggle" class="hamburger">&#9776;</label>
    <ul class="navbar-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="petform.html">Find a Pet</a></li>
      <li><a href="pets.html">Pets</a></li>
      <li><a href="admin.html">Admin</a></li>
      <li><a href="profile.html">Profile</a></li>
      <li id="auth-link"><a href="login.html">Login</a></li>
    </ul>
  </nav>

  <main>
    <h2 style="text-align: center;">Available Pets</h2>
    <div class="pets-grid"></div>
  </main>

  <footer class="footer-container">
    <div class="footer-links">
      <a href="index.html">Home</a>
      <a href="petform.html">Find a Pet</a>
      <a href="admin.html">Admin</a>
      <a href="profile.html">Profile</a>
      <a href="contact.html">Contact Us</a>
    </div>
    <p>© 2025 PetPair. All rights reserved.</p>
  </footer>

  <script>
    const authLinkLi = document.getElementById('auth-link');

    function updateAuthLink() {
      const user = JSON.parse(localStorage.getItem('user'));
      if (user) {
        authLinkLi.innerHTML = '<a href="#" id="logoutLink">Logout</a>';
        document.getElementById('logoutLink').addEventListener('click', () => {
          localStorage.removeItem('user');
          alert('Logged out successfully.');
          window.location.href = 'index.html';
        });
      } else {
        authLinkLi.innerHTML = '<a href="login.html">Login</a>';
      }
    }

    updateAuthLink();

    const hardcodedPets = [
      {
        name: "Buddy",
        type: "Dog",
        size: "Medium",
        temperament: "Playful",
        description: "A friendly dog who loves to play fetch.",
        maintenanceCost: "15000",
        image: "https://placedog.net/400/300?id=1"
      },
      {
        name: "Whiskers",
        type: "Cat",
        size: "Small",
        temperament: "Calm",
        description: "A calm cat who enjoys cuddles.",
        maintenanceCost: "8000",
        image: "https://cdn2.thecatapi.com/images/MTY3ODIyMQ.jpg"
      }
    ];

    async function fetchPets() {
      try {
        const res = await fetch('http://localhost:5000/api/pets');
        if (!res.ok) throw new Error('Failed to fetch pets');
        const pets = await res.json();
        return pets;
      } catch (error) {
        alert('Error fetching pets: ' + error.message);
        return [];
      }
    }

    async function displayPets() {
      const petList = document.querySelector('.pets-grid');
      petList.innerHTML = '';

      const backendPets = await fetchPets();
      const allPets = [...hardcodedPets, ...backendPets];

      allPets.forEach(pet => {
        const card = document.createElement('div');
        card.className = 'pet-card';
        card.style.height = '420px';
        card.style.display = 'flex';
        card.style.flexDirection = 'column';
        card.style.alignItems = 'center';
        card.style.boxSizing = 'border-box';

        const user = JSON.parse(localStorage.getItem('user'));
        let buttonsHTML = '';

        if (user) {
          if (user.role === 'admin') {
            buttonsHTML += `<button class="remove-btn">Remove</button>`;
          } else {
            buttonsHTML += `<button class="request-btn">Request</button>`;
          }
        }

        card.innerHTML = `
          <img 
            src="${pet.imageUrl || pet.image}" 
            alt="${pet.name}" 
            style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 1rem;"
            onerror="this.src='https://via.placeholder.com/150?text=No+Image';"
          />
          <h3>${pet.name}</h3>
          <p class="pet-attr"><strong>Type:</strong> ${pet.type}</p>
          <p class="pet-attr"><strong>Size:</strong> ${pet.size}</p>
          <p class="pet-attr"><strong>Temperament:</strong> ${pet.temperament}</p>
          <p>${pet.description}</p>
          <p class="maintenance" style="margin-top: auto;">
            Maintenance Cost: ₹${Number(pet.maintenanceCost).toLocaleString()} / month
          </p>
          ${buttonsHTML}
        `;

        const requestBtn = card.querySelector('.request-btn');
        if (requestBtn) {
          requestBtn.addEventListener('click', () => {
            sessionStorage.setItem('selectedPet', JSON.stringify(pet));
            window.location.href = 'request.html';
          });
        }

        const removeBtn = card.querySelector('.remove-btn');
        if (removeBtn) {
          removeBtn.addEventListener('click', async () => {
            if (!confirm(`Are you sure you want to remove ${pet.name}?`)) return;

            try {
              if (!user || user.role !== 'admin') {
                alert('You must be logged in as admin to remove pets.');
                return;
              }

              const res = await fetch(`http://localhost:5000/api/pets/${pet._id}`, {
                method: 'DELETE',
                headers: {
                  'Authorization': 'Bearer ' + user.token
                }
              });

              if (!res.ok) {
                const err = await res.json();
                alert('Failed to remove pet: ' + (err.message || res.statusText));
                return;
              }

              alert(`${pet.name} removed successfully.`);
              card.remove();
            } catch (error) {
              alert('Network error: ' + error.message);
            }
          });
        }

        petList.appendChild(card);
      });
    }

    displayPets();
  </script>

</body>
</html>
